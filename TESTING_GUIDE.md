# 題庫篩選功能測試指南

## 測試環境準備

### 1. 啟動後端服務
```bash
cd backend
./venv/bin/python manage.py runserver
```

### 2. 啟動前端服務
```bash
cd frontend
npm run dev
```

### 3. 登入系統
- 使用老師帳號登入（題庫功能只有老師可以訪問）

## 手動測試步驟

### 測試 1: 科目篩選
1. 進入題庫管理頁面
2. 在「科目」下拉選單中選擇一個科目（例如：數學）
3. 點擊「搜尋」按鈕
4. **預期結果**：只顯示該科目的題目

### 測試 2: 年級篩選
1. 在「年級」下拉選單中選擇一個年級（例如：高中）
2. 點擊「搜尋」按鈕
3. **預期結果**：只顯示該年級的題目

### 測試 3: 章節篩選
1. 在「章節」輸入框中輸入章節名稱（例如：向量）
2. 點擊「搜尋」按鈕
3. **預期結果**：只顯示章節名稱包含該關鍵字的題目

### 測試 4: 難度篩選
1. 在「難度」下拉選單中選擇一個難度（例如：3 星）
2. 點擊「搜尋」按鈕
3. **預期結果**：只顯示該難度的題目

### 測試 5: 題目類型篩選
1. 在「題目類型」下拉選單中選擇一個類型（例如：單選題）
2. 點擊「搜尋」按鈕
3. **預期結果**：只顯示該類型的題目

### 測試 6: 標籤篩選
1. 在「標籤」下拉選單中選擇一個標籤
2. 點擊「搜尋」按鈕
3. **預期結果**：只顯示包含該標籤的題目

### 測試 7: 來源篩選 ⭐ 新增功能
1. 在「來源」下拉選單中選擇一個來源（例如：九章自命題）
2. 點擊「搜尋」按鈕
3. **預期結果**：只顯示該來源的題目

### 測試 8: 多條件組合篩選
1. 同時選擇多個篩選條件（例如：科目=數學、年級=高中、難度=3星）
2. 點擊「搜尋」按鈕
3. **預期結果**：只顯示符合所有條件的題目

### 測試 9: 分頁功能
1. 確保有足夠的題目（超過 10 題）
2. 查看分頁控件是否顯示
3. 點擊「下一頁」按鈕
4. **預期結果**：
   - 顯示第 2 頁的題目
   - 分頁資訊正確更新（例如：第 2 / 5 頁）

### 測試 10: 重置篩選
1. 設置多個篩選條件
2. 點擊「重置」按鈕
3. **預期結果**：
   - 所有篩選條件被清除
   - 顯示所有題目（或第一頁）

### 測試 11: 空結果處理
1. 設置一個不會匹配任何題目的篩選條件組合
2. 點擊「搜尋」按鈕
3. **預期結果**：顯示「尚無題目，點擊右上角新增」的提示

## 瀏覽器開發者工具檢查

### 檢查 API 請求
1. 打開瀏覽器開發者工具（F12）
2. 切換到「Network」標籤
3. 執行一個篩選操作
4. 找到對應的 API 請求（通常是 `/api/cramschool/questions/`）
5. 檢查請求參數：
   - 確認所有篩選參數都正確傳遞
   - 確認參數名稱正確（例如：`subject`、`level`、`tags` 等）

### 檢查 API 響應
1. 點擊 API 請求查看響應
2. 確認響應格式：
   ```json
   {
     "count": 總數,
     "next": "下一頁URL或null",
     "previous": "上一頁URL或null",
     "results": [題目列表]
   }
   ```
3. 確認 `results` 中的題目符合篩選條件

## 自動化測試（可選）

### 使用 Python 測試腳本
```bash
# 安裝依賴（如果需要）
pip install requests

# 運行測試腳本
python test_question_filters.py
```

**注意**：測試腳本需要：
- 後端服務正在運行
- 如果需要認證，請在腳本中設置 TOKEN

## 常見問題排查

### 問題 1: 篩選沒有反應
- **檢查**：瀏覽器控制台是否有錯誤
- **檢查**：Network 標籤中 API 請求是否成功（狀態碼 200）
- **檢查**：API 響應是否包含正確的數據

### 問題 2: 標籤篩選不工作
- **檢查**：後端是否正確處理 `tags` 參數
- **檢查**：Network 中請求 URL 是否包含 `tags=1` 或 `tags[]=1`

### 問題 3: 分頁不正確
- **檢查**：API 響應中的 `count` 是否正確
- **檢查**：前端計算的 `totalPages` 是否正確（`Math.ceil(count / 10)`）

### 問題 4: 來源選項為空
- **檢查**：`fetchSourceOptions()` 是否成功調用
- **檢查**：API `/api/cramschool/questions/source_options/` 是否返回數據
- **檢查**：瀏覽器控制台是否有錯誤

## 測試檢查清單

- [ ] 科目篩選正常
- [ ] 年級篩選正常
- [ ] 章節篩選正常
- [ ] 難度篩選正常
- [ ] 題目類型篩選正常
- [ ] 標籤篩選正常
- [ ] 來源篩選正常 ⭐
- [ ] 多條件組合篩選正常
- [ ] 分頁功能正常
- [ ] 重置功能正常
- [ ] 空結果處理正常
- [ ] API 請求參數正確
- [ ] API 響應格式正確

## 修正記錄

### 2024-12-XX
- ✅ 修正標籤篩選參數名稱問題（後端現在支援 `tags[]` 和 `tags`）
- ✅ 移除無效的 `page_size` 參數
- ✅ 新增來源篩選功能
