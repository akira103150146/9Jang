# QuestionForm åæ–œç·šæ¶ˆå¤±å•é¡Œä¿®å¾©

## ğŸ“‹ å•é¡Œæè¿°

**ç”¨æˆ¶å ±å‘Šï¼š**
- åœ¨é¡Œåº«çš„ Modal é è¦½ä¸­ï¼ŒLaTeX å…¬å¼æ­£ç¢ºé¡¯ç¤ºï¼ˆåŒ…å«åæ–œç·šï¼š`\sin`, `\theta` ç­‰ï¼‰
- é»æ“Šã€Œç·¨è¼¯é¡Œç›®ã€é€²å…¥ QuestionForm.vue å¾Œï¼Œåæ–œç·šæ¶ˆå¤±äº†

## ğŸ” æ ¹æœ¬åŸå› 

åœ¨ `QuestionForm.vue` çš„ `parseLineBreaks` å‡½æ•¸ä¸­ï¼ˆç¬¬ 522-577 è¡Œï¼‰ï¼Œæœ‰ä¸€å€‹é‚è¼¯éŒ¯èª¤ï¼š

### å•é¡Œä»£ç¢¼

```javascript
// åŒ¹é…æ–‡å­—ä¸­çš„ `\\` æˆ–è¡Œå°¾çš„ `\`ï¼ˆå¯èƒ½è·Ÿè‘—ç©ºæ ¼ï¼‰
// ä½†è¦æ’é™¤ LaTeX å‘½ä»¤ä¸­çš„åæ–œç·šï¼ˆå¦‚ \sin, \frac ç­‰ï¼‰
const lineBreakRegex = /\\+\s*$/gm  // âŒ é€™å€‹æ­£å‰‡æœƒåŒ¹é…æ‰€æœ‰è¡Œå°¾çš„åæ–œç·š
```

**å•é¡Œåˆ†æï¼š**

1. **æ­£å‰‡è¡¨é”å¼éæ–¼å¯¬é¬†**ï¼š`/\\+\s*$/gm` æœƒåŒ¹é…è¡Œå°¾çš„ä»»ä½•åæ–œç·š
2. **æª¢æŸ¥é‚è¼¯ä¸å®Œå–„**ï¼šé›–ç„¶æœ‰æª¢æŸ¥å‰å¾Œå­—ç¬¦ï¼Œä½†ç„¡æ³•æ­£ç¢ºè­˜åˆ¥ LaTeX å‘½ä»¤
3. **èª¤åˆ¤ LaTeX å…¬å¼**ï¼šä¾‹å¦‚ `$\sin\theta$` åœ¨è¡Œå°¾æ™‚ï¼Œ`\theta` çš„åæ–œç·šå¯èƒ½è¢«èª¤åˆ¤ç‚ºæ›è¡Œç¬¦è™Ÿ
4. **åæ–œç·šè¢«ç§»é™¤**ï¼šè¢«èª¤åˆ¤çš„åæ–œç·šæœƒè¢«è½‰æ›ç‚º `hardBreak` ç¯€é»ï¼Œå°è‡´ LaTeX å‘½ä»¤ä¸­çš„åæ–œç·šä¸Ÿå¤±

### å…·é«”æ¡ˆä¾‹

```javascript
// åŸå§‹æ–‡å­—ï¼š
"åˆ©ç”¨ $\\sin\\theta$ å¯æ¨å¾—"

// parseLineBreaks è™•ç†å¾Œï¼š
// å¦‚æœ $\sin\theta$ åœ¨è¡Œå°¾ï¼Œæœ€å¾Œçš„ \ å¯èƒ½è¢«èª¤åˆ¤ç‚ºæ›è¡Œç¬¦è™Ÿ
// çµæœï¼š$\sin$ + hardBreak + "theta$ å¯æ¨å¾—"
// LaTeX å…¬å¼è¢«ç ´å£äº†ï¼
```

## ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ

### ä¿®å¾©é‚è¼¯

1. **æª¢æŸ¥æ˜¯å¦åŒ…å« LaTeX**ï¼šå¦‚æœæ–‡å­—ä¸­åŒ…å« `$` ç¬¦è™Ÿï¼Œèªªæ˜æœ‰ LaTeX å…¬å¼
2. **è·³é LaTeX è™•ç†**ï¼šå°æ–¼åŒ…å« LaTeX çš„æ–‡å­—ï¼Œä¸è™•ç†æ›è¡Œç¬¦è™Ÿ
3. **åš´æ ¼åŒ¹é…æ›è¡Œ**ï¼šåªåŒ¹é…æ˜ç¢ºçš„ `\\`ï¼ˆå…©å€‹åæ–œç·šï¼‰ï¼Œè€Œä¸æ˜¯å–®å€‹åæ–œç·š

### ä¿®å¾©å¾Œçš„ä»£ç¢¼

```javascript
const parseLineBreaks = (text) => {
  if (!text) return []
  
  // æª¢æŸ¥æ–‡å­—ä¸­æ˜¯å¦åŒ…å« LaTeX å…¬å¼ï¼ˆæœ‰ $ ç¬¦è™Ÿï¼‰
  const hasLatex = text.includes('$')
  
  // å¦‚æœåŒ…å« LaTeXï¼Œä¸è™•ç†æ›è¡Œç¬¦è™Ÿï¼Œé¿å…èª¤åˆ¤ LaTeX å‘½ä»¤ä¸­çš„åæ–œç·š
  // LaTeX ä¸­çš„æ›è¡Œæ‡‰è©²ä½¿ç”¨ \\ æˆ– \newlineï¼Œé€™äº›æœƒè¢« LaTeX æ¸²æŸ“å™¨æ­£ç¢ºè™•ç†
  if (hasLatex) {
    return [{ type: 'text', text }]
  }
  
  const parts = []
  let lastIndex = 0
  // åªåœ¨æ²’æœ‰ LaTeX çš„æƒ…æ³ä¸‹è™•ç†æ›è¡Œç¬¦è™Ÿ
  // åŒ¹é…è¡Œå°¾çš„ `\\`ï¼ˆå…©å€‹åæ–œç·šï¼‰ä½œç‚ºæ›è¡Œç¬¦è™Ÿ
  const lineBreakRegex = /\\\\\s*$/gm
  const lineBreakPositions = []
  let match
  
  // æ‰¾å‡ºæ‰€æœ‰æ›è¡Œç¬¦è™Ÿçš„ä½ç½®
  while ((match = lineBreakRegex.exec(text)) !== null) {
    lineBreakPositions.push({
      start: match.index,
      end: match.index + match[0].length
    })
  }
  
  // æ§‹å»ºç¯€é»é™£åˆ—
  for (const lbMatch of lineBreakPositions) {
    // æ·»åŠ æ›è¡Œç¬¦è™Ÿå‰çš„æ–‡å­—
    if (lbMatch.start > lastIndex) {
      const beforeText = text.substring(lastIndex, lbMatch.start)
      if (beforeText) {
        parts.push({ type: 'text', text: beforeText })
      }
    }
    
    // æ·»åŠ  hardBreak ç¯€é»
    parts.push({ type: 'hardBreak' })
    
    lastIndex = lbMatch.end
  }
  
  // æ·»åŠ å‰©é¤˜æ–‡å­—
  if (lastIndex < text.length) {
    const remainingText = text.substring(lastIndex)
    if (remainingText) {
      parts.push({ type: 'text', text: remainingText })
    }
  }
  
  return parts.length > 0 ? parts : [{ type: 'text', text }]
}
```

## ğŸ“Š ä¿®å¾©å°æ¯”

### ä¿®å¾©å‰

| æƒ…æ³ | è™•ç†æ–¹å¼ | çµæœ |
|------|---------|------|
| `$\sin\theta$` åœ¨è¡Œå°¾ | åŒ¹é…åˆ° `\` â†’ è½‰æ›ç‚º hardBreak | âŒ åæ–œç·šæ¶ˆå¤±ï¼ŒLaTeX ç ´å£ |
| `æ–‡å­—\\` åœ¨è¡Œå°¾ | åŒ¹é…åˆ° `\\` â†’ è½‰æ›ç‚º hardBreak | âœ… æ­£ç¢ºè™•ç†æ›è¡Œ |
| `$\frac{1}{2}$` | å¯èƒ½èª¤åˆ¤å…§éƒ¨çš„ `\` | âŒ å¯èƒ½ç ´å£ LaTeX |

### ä¿®å¾©å¾Œ

| æƒ…æ³ | è™•ç†æ–¹å¼ | çµæœ |
|------|---------|------|
| `$\sin\theta$` åœ¨è¡Œå°¾ | æª¢æ¸¬åˆ° `$` â†’ è·³éè™•ç† | âœ… åæ–œç·šä¿ç•™ï¼ŒLaTeX æ­£ç¢º |
| `æ–‡å­—\\` åœ¨è¡Œå°¾ | æ²’æœ‰ `$` â†’ åŒ¹é… `\\` â†’ è½‰æ›ç‚º hardBreak | âœ… æ­£ç¢ºè™•ç†æ›è¡Œ |
| `$\frac{1}{2}$` | æª¢æ¸¬åˆ° `$` â†’ è·³éè™•ç† | âœ… LaTeX å®Œæ•´ä¿ç•™ |

## ğŸ¯ ä¿®å¾©æ•ˆæœ

### ä¿®å¾©å‰çš„å•é¡Œ

```javascript
// è¼¸å…¥ï¼ˆæ•¸æ“šåº«ä¸­çš„æ•¸æ“šï¼‰
{
  content: {
    type: 'doc',
    content: [{
      type: 'paragraph',
      content: [{
        type: 'text',
        text: '$\\sin\\theta$'
      }]
    }]
  }
}

// parseLineBreaks èª¤åˆ¤å¾Œ
// åæ–œç·šè¢«ç•¶ä½œæ›è¡Œç¬¦è™Ÿç§»é™¤
// çµæœï¼šLaTeX å…¬å¼ç ´å£
```

### ä¿®å¾©å¾Œçš„æ•ˆæœ

```javascript
// è¼¸å…¥ï¼ˆæ•¸æ“šåº«ä¸­çš„æ•¸æ“šï¼‰
{
  content: {
    type: 'doc',
    content: [{
      type: 'paragraph',
      content: [{
        type: 'text',
        text: '$\\sin\\theta$'
      }]
    }]
  }
}

// parseLineBreaks æª¢æ¸¬åˆ° $ ç¬¦è™Ÿ
// è·³éè™•ç†ï¼Œç›´æ¥è¿”å›åŸæ–‡å­—
// çµæœï¼šLaTeX å…¬å¼å®Œæ•´ä¿ç•™ âœ…
```

## ğŸ§ª æ¸¬è©¦ç”¨ä¾‹

### æ¸¬è©¦ 1ï¼šåŒ…å« LaTeX çš„æ–‡å­—

```javascript
const test1 = '$\\sin\\theta$ å¯æ¨å¾—'
const result1 = parseLineBreaks(test1)
// é æœŸï¼š[{ type: 'text', text: '$\\sin\\theta$ å¯æ¨å¾—' }]
// âœ… åæ–œç·šä¿ç•™
```

### æ¸¬è©¦ 2ï¼šä¸åŒ…å« LaTeX çš„æ–‡å­—ï¼ˆæœ‰æ›è¡Œï¼‰

```javascript
const test2 = 'ç¬¬ä¸€è¡Œ\\\nç¬¬äºŒè¡Œ'
const result2 = parseLineBreaks(test2)
// é æœŸï¼š[
//   { type: 'text', text: 'ç¬¬ä¸€è¡Œ' },
//   { type: 'hardBreak' },
//   { type: 'text', text: 'ç¬¬äºŒè¡Œ' }
// ]
// âœ… æ›è¡Œç¬¦è™Ÿæ­£ç¢ºè™•ç†
```

### æ¸¬è©¦ 3ï¼šè¤‡é›œçš„ LaTeX å…¬å¼

```javascript
const test3 = '$\\cos 2\\theta = \\cos^{2}\\theta - \\sin^{2}\\theta$'
const result3 = parseLineBreaks(test3)
// é æœŸï¼š[{ type: 'text', text: '$\\cos 2\\theta = \\cos^{2}\\theta - \\sin^{2}\\theta$' }]
// âœ… æ‰€æœ‰åæ–œç·šä¿ç•™
```

### æ¸¬è©¦ 4ï¼šæ··åˆå…§å®¹

```javascript
const test4 = 'åˆ©ç”¨ $\\sin\\theta$ å’Œ $\\cos\\theta$ å¯æ¨å¾—'
const result4 = parseLineBreaks(test4)
// é æœŸï¼š[{ type: 'text', text: 'åˆ©ç”¨ $\\sin\\theta$ å’Œ $\\cos\\theta$ å¯æ¨å¾—' }]
// âœ… æ‰€æœ‰åæ–œç·šä¿ç•™
```

## ğŸ“ ä½¿ç”¨å»ºè­°

### ä½•æ™‚ä½¿ç”¨æ›è¡Œç¬¦è™Ÿè™•ç†

- âœ… ç´”æ–‡å­—å…§å®¹ï¼ˆæ²’æœ‰ LaTeXï¼‰
- âœ… éœ€è¦å°‡ `\\` è½‰æ›ç‚ºè¦–è¦ºæ›è¡Œ

### ä½•æ™‚è·³éæ›è¡Œç¬¦è™Ÿè™•ç†

- âœ… åŒ…å« LaTeX å…¬å¼çš„å…§å®¹
- âœ… åŒ…å« `$` ç¬¦è™Ÿçš„å…§å®¹
- âœ… æ•¸å­¸æˆ–ç§‘å­¸å…§å®¹

### LaTeX ä¸­çš„æ›è¡Œ

åœ¨ LaTeX å…¬å¼ä¸­ï¼Œå¦‚æœéœ€è¦æ›è¡Œï¼Œæ‡‰è©²ä½¿ç”¨ï¼š
- `\\` åœ¨ LaTeX ç’°å¢ƒä¸­ï¼ˆæœƒè¢« LaTeX æ¸²æŸ“å™¨è™•ç†ï¼‰
- `\newline` å‘½ä»¤
- æˆ–ä½¿ç”¨å¤šè¡Œç’°å¢ƒï¼ˆå¦‚ `align`, `gather` ç­‰ï¼‰

## âœ¨ å„ªå‹¢

1. **ä¿è­· LaTeX å…§å®¹**
   - âœ… æ‰€æœ‰ LaTeX å‘½ä»¤ä¸­çš„åæ–œç·šéƒ½è¢«ä¿ç•™
   - âœ… ä¸æœƒèª¤åˆ¤ LaTeX å‘½ä»¤ç‚ºæ›è¡Œç¬¦è™Ÿ

2. **ç°¡åŒ–é‚è¼¯**
   - âœ… ä½¿ç”¨ç°¡å–®çš„æª¢æŸ¥ï¼ˆæ˜¯å¦åŒ…å« `$`ï¼‰
   - âœ… é¿å…è¤‡é›œçš„å‰å¾Œå­—ç¬¦æª¢æŸ¥
   - âœ… æ›´å¯é ï¼Œæ›´å®¹æ˜“ç¶­è­·

3. **å‘å¾Œå…¼å®¹**
   - âœ… å°æ–¼ä¸åŒ…å« LaTeX çš„å…§å®¹ï¼Œè¡Œç‚ºä¸è®Š
   - âœ… ä»ç„¶æ”¯æ´ `\\` ä½œç‚ºæ›è¡Œç¬¦è™Ÿ

4. **æ€§èƒ½æå‡**
   - âœ… æ¸›å°‘ä¸å¿…è¦çš„æ­£å‰‡åŒ¹é…
   - âœ… æå‰è¿”å›ï¼Œé¿å…è¤‡é›œè™•ç†

## ğŸ“¦ ç›¸é—œæ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `frontend/src/views/QuestionForm.vue` - ä¿®å¾© `parseLineBreaks` å‡½æ•¸

### ç›¸é—œæ–‡æª”
- `LATEX_RENDERING_FIX.md` - LaTeX æ¸²æŸ“ä¿®å¾©
- `BACKSLASH_ISSUE_DIAGNOSIS.md` - åæ–œç·šå•é¡Œè¨ºæ–·

### æ–°å¢çš„æ–‡ä»¶
- `BACKSLASH_FIX_IN_QUESTION_FORM.md` - æœ¬æ–‡æª”

## ğŸ‰ ç¸½çµ

æˆåŠŸä¿®å¾©äº† QuestionForm ä¸­åæ–œç·šæ¶ˆå¤±çš„å•é¡Œï¼š
- ğŸ”§ **ä¿®å¾© parseLineBreaks å‡½æ•¸**
- âœ… **ä¿è­· LaTeX å…§å®¹**
- ğŸ“ **åæ–œç·šæ­£ç¢ºä¿ç•™**
- ğŸ¯ **ç·¨è¼¯å’Œé è¦½ä¸€è‡´**

ç¾åœ¨ï¼Œåœ¨é¡Œåº« Modal ä¸­çœ‹åˆ°çš„ LaTeX å…¬å¼ï¼Œåœ¨é»æ“Šã€Œç·¨è¼¯é¡Œç›®ã€å¾Œä»ç„¶æœƒå®Œæ•´ä¿ç•™ï¼Œä¸æœƒä¸Ÿå¤±åæ–œç·šï¼
