# 前端依賴版本管理指南

## 📊 當前狀態

### 版本範圍策略

目前項目使用 **範圍版本**（`^` 符號），例如：
- `"vue": "^3.4.21"` - 允許 3.4.21 到 3.x.x 的更新
- `"vite": "^5.1.4"` - 允許 5.1.4 到 5.x.x 的更新
- `"typescript": "^5.3.3"` - 允許 5.3.3 到 5.x.x 的更新

### 版本鎖定

**pnpm-lock.yaml** 會鎖定實際安裝的版本，確保：
- ✅ 所有開發者安裝相同版本
- ✅ CI/CD 環境使用相同版本
- ✅ 生產構建使用相同版本

## 🤔 需要固定版本嗎？

### ✅ 當前策略（推薦用於開發）

**使用範圍版本 + pnpm-lock.yaml**

**優點：**
- ✅ 自動獲得安全修復和 bug 修復（補丁版本）
- ✅ 自動獲得新功能（小版本）
- ✅ `pnpm-lock.yaml` 確保團隊一致性
- ✅ 更靈活，易於維護

**缺點：**
- ⚠️ 需要定期更新依賴
- ⚠️ 可能引入不兼容的更新（雖然 `^` 只允許小版本）

### 🔒 固定版本策略

**使用確切版本（移除 `^`）**

**優點：**
- ✅ 完全控制版本
- ✅ 避免意外更新

**缺點：**
- ❌ 需要手動更新每個依賴
- ❌ 可能錯過安全修復
- ❌ 維護成本高

## 💡 建議

### 開發環境：保持當前策略 ✅

**推薦做法：**
1. **保持範圍版本**（`^`）- 在 `package.json` 中
2. **提交 `pnpm-lock.yaml`** - 確保版本鎖定
3. **定期更新** - 使用 `pnpm update` 更新依賴

### 關鍵依賴：考慮固定版本

對於以下關鍵依賴，可以考慮固定版本：

```json
{
  "dependencies": {
    "vue": "3.4.21",           // 移除 ^，固定版本
    "vue-router": "4.3.0",      // 移除 ^
    "@tiptap/core": "2.1.13"    // 移除 ^
  }
}
```

**需要固定的情況：**
- 🔴 框架核心（Vue, React 等）- 避免破壞性更新
- 🔴 關鍵業務依賴（Tiptap, CodeMirror）- 確保穩定性
- 🟡 工具類（Vite, TypeScript）- 可以保持範圍版本

## 🔧 實際操作

### 檢查當前安裝的版本

```bash
# 查看實際安裝的版本
pnpm list --depth=0

# 查看特定包的版本
pnpm list vue
pnpm list vite
```

### 更新依賴

```bash
# 更新所有依賴到範圍內的最新版本
pnpm update

# 更新特定依賴
pnpm update vue

# 更新到最新版本（可能超出範圍）
pnpm update vue@latest
```

### 固定版本（如果需要）

```bash
# 安裝確切版本（會更新 package.json）
pnpm add vue@3.4.21 --save-exact

# 或手動編輯 package.json，移除 ^ 符號
```

## 📋 最佳實踐

### 1. 開發階段
- ✅ 使用範圍版本（`^`）
- ✅ 提交 `pnpm-lock.yaml`
- ✅ 定期運行 `pnpm update`

### 2. 發布前
- ✅ 檢查 `pnpm-lock.yaml` 中的版本
- ✅ 測試所有功能
- ✅ 考慮固定關鍵依賴版本

### 3. 生產環境
- ✅ 使用 `pnpm install --frozen-lockfile`（CI/CD）
- ✅ 確保使用 `pnpm-lock.yaml` 鎖定的版本

## 🎯 針對您的項目

### 當前建議：**保持現狀** ✅

**原因：**
1. ✅ 您已經有 `pnpm-lock.yaml` 鎖定版本
2. ✅ 範圍版本提供靈活性
3. ✅ TypeScript 遷移已完成，依賴穩定

### 可選優化

如果希望更嚴格控制，可以固定以下關鍵依賴：

```json
{
  "dependencies": {
    "vue": "3.4.21",                    // 固定
    "vue-router": "4.3.0",              // 固定
    "@tiptap/core": "2.1.13",           // 固定
    "@tiptap/vue-3": "2.1.13",          // 固定
    "axios": "^1.6.7",                  // 保持範圍
    "katex": "^0.16.27"                 // 保持範圍
  }
}
```

## 📝 總結

**開發時不需要固定所有版本**，因為：
- ✅ `pnpm-lock.yaml` 已經鎖定了實際安裝的版本
- ✅ 範圍版本提供靈活性和自動更新
- ✅ 團隊成員會安裝相同的版本（通過 lockfile）

**建議：**
- 保持當前的範圍版本策略
- 定期更新依賴：`pnpm update`
- 只在遇到兼容性問題時固定特定版本

